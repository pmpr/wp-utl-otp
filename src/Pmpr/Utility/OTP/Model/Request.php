<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             681764bfab6cd             |
    |_______________________________________|
*/
 namespace Pmpr\Utility\OTP\Model; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Common\Foundation\Interfaces\IconInterface; use Pmpr\Common\Foundation\ORM\Model; use Pmpr\Utility\OTP\Setting; use WP_Error; class Request extends Model { const uqsoyaggyisgkkcy = 5; const eakceewagesqqyqm = 'opt_code'; const uekycsgykyskuiea = 'attempts'; const kmywkmmykgoyyyoy = 'value_type'; const gikwakkmgcuukuqe = 'email_or_mobile'; public function register() { $this->muuwuqssqkaieqge(__('OTP Requests', PR__UTL__OTP))->guiaswksukmgageq(__('OTP Request', PR__UTL__OTP))->saemoowcasogykak(IconInterface::cakimsccucqweeqq); } public function uwmqacgewuauagai() { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $this->cquokmemekqqywgi($eqwoegegiamegqsm->qoemykoeuecmsmwe(Constants::yauicucwkgqyygas)->gswweykyogmsyawy(__('User', PR__UTL__OTP))->acceqyqygswoecwe(11))->cquokmemekqqywgi($eqwoegegiamegqsm->usqseiuaeauwuwus(self::eakceewagesqqyqm)->gswweykyogmsyawy(__('code', PR__UTL__OTP))->acceqyqygswoecwe(self::uqsoyaggyisgkkcy))->cquokmemekqqywgi($eqwoegegiamegqsm->usqseiuaeauwuwus(self::gikwakkmgcuukuqe)->gswweykyogmsyawy(__('Email OR Mobile', PR__UTL__OTP))->acceqyqygswoecwe(255))->cquokmemekqqywgi($eqwoegegiamegqsm->yyuiuwgokmwioomq(Constants::squoamkioomemiyi)->gswweykyogmsyawy(__('Type', PR__UTL__OTP))->kesomeowemmyygey(1, Constants::muqaqimusmckkieq, __('Email', PR__UTL__OTP))->kesomeowemmyygey(2, Constants::skogicecygyyskkq, __('Mobile', PR__UTL__OTP)))->cquokmemekqqywgi($eqwoegegiamegqsm->yyuiuwgokmwioomq(Constants::ciywsqoeiymemsys)->gswweykyogmsyawy(__('Status', PR__UTL__OTP))->kesomeowemmyygey(1, Constants::sgoswgskyiiwkyuo, __('Pending', PR__UTL__OTP))->kesomeowemmyygey(2, Constants::gikauwqcswqcsmqw, __('Used', PR__UTL__OTP))->kesomeowemmyygey(3, Constants::qaquimukkogikqou, __('Expired', PR__UTL__OTP))->kesomeowemmyygey(4, Constants::uasuowkaguiwoouw, __('Failed', PR__UTL__OTP)))->cquokmemekqqywgi($eqwoegegiamegqsm->usqseiuaeauwuwus(Constants::ioksewgkgwwikiwo)->acceqyqygswoecwe(45))->cquokmemekqqywgi($eqwoegegiamegqsm->qoemykoeuecmsmwe(self::uekycsgykyskuiea)->eyygsasuqmommkua(0)->acceqyqygswoecwe(2))->cquokmemekqqywgi($eqwoegegiamegqsm->qwwuoqeeiyuoyogs(Constants::CREATED_AT)->gswweykyogmsyawy(__('Created At', PR__UTL__OTP))); parent::uwmqacgewuauagai(); } public function ioimaaeesiaysecu($eyykcmsqgsgcoosq, $qwiggmeasieaecug = null) { if ($this->uwkmaywceaaaigwo()->gyecsegqciqykomu()->qkgmsqgmwoamekyk($eyykcmsqgsgcoosq)) { $sqeykgyoooqysmca = Constants::muqaqimusmckkieq; $mkucggyaiaukqoce = $this->uwkmaywceaaaigwo()->issssuygyewuaswa()->woimamkkeyoyauoa(Constants::muqaqimusmckkieq, $eyykcmsqgsgcoosq); } else { if ($this->caokeucsksukesyo()->gyecsegqciqykomu()->qawecuimqqcqwgsw($eyykcmsqgsgcoosq)) { $sqeykgyoooqysmca = Constants::skogicecygyyskkq; $mkucggyaiaukqoce = $this->caokeucsksukesyo()->issssuygyewuaswa()->esyoeukyscaiucga(Constants::uymswsomcyoqsegc, $eyykcmsqgsgcoosq); } else { return $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Your entered value is not a mobile or email address.', PR__UTL__OTP)); } } if ($sqeykgyoooqysmca && $eyykcmsqgsgcoosq) { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $qkqgcaykemoiecma = $this->uwkmaywceaaaigwo()->giiuwsmyumqwwiyq(); $ycoeoaakqyskgykq = $mkucggyaiaukqoce ? $this->caokeucsksukesyo()->issssuygyewuaswa()->iooowgsqoyqseyuu($mkucggyaiaukqoce, true) : 0; $cwagagqyawwowooo = 'user_login_wait_' . md5("{$ycoeoaakqyskgykq}:{$eyykcmsqgsgcoosq}:{$qwiggmeasieaecug}"); $yuqykyiisqmimaqm = (int) $qkqgcaykemoiecma->igqksmmwesguiaae($cwagagqyawwowooo); $yeacayasgueouoqc = $this->caokeucsksukesyo()->sgqicqeoumwmsmyw()->gwgmymsuwsceguce(); $agkweggkkoqakimy = false; if ($yuqykyiisqmimaqm) { if ($yeacayasgueouoqc < $yuqykyiisqmimaqm) { $wkummegycaugwmyq = $yuqykyiisqmimaqm - $yeacayasgueouoqc; return $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(sprintf(__('Please try again after %s.', PR__UTL__OTP), $this->caokeucsksukesyo()->sgqicqeoumwmsmyw()->aaqkcwqaikooouus(ceil($wkummegycaugwmyq / 60))), 429); } else { $agkweggkkoqakimy = true; } } $caacssaumiqeaoaw = date('Y-m-d H:i:s', $yeacayasgueouoqc - 2 * HOUR_IN_SECONDS); $gqgemcmoicmgaqie = $eqwoegegiamegqsm->kyckwuuiqwmyoqma()->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::ciywsqoeiymemsys, [Constants::sgoswgskyiiwkyuo, Constants::qaquimukkogikqou, Constants::uasuowkaguiwoouw]))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::yauicucwkgqyygas, $ycoeoaakqyskgykq))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim()->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim(Constants::ioksewgkgwwikiwo, $qwiggmeasieaecug)->iygikqkegwkaaess())->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim(self::gikwakkmgcuukuqe, $eyykcmsqgsgcoosq)->iygikqkegwkaaess()))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::CREATED_AT, $caacssaumiqeaoaw)->maqiysyuqmwcqoig('>=')); $igugusokykuywkko = $this->iswwcsskwikikwuk(); $kcayakscccogcmqe = $this->iekyeyicoyyawomk()->asskucacysemeoiu($gqgemcmoicmgaqie); if ($kcayakscccogcmqe <= $igugusokykuywkko || $agkweggkkoqakimy) { $qkqgcaykemoiecma->cqgekgeqacmqquas($cwagagqyawwowooo); $ymacoouqwcqwwagu = $this->caokeucsksukesyo()->owgcciayoweymuws()->gykqksiwukaccoyg(self::uqsoyaggyisgkkcy, Constants::eymwucuaaiiciymc); $sogksuscggsicmac = $this->gssiscqyqsacmeca()->gsegsiocqmsoayii([Constants::ioksewgkgwwikiwo => $qwiggmeasieaecug, self::eakceewagesqqyqm => $ymacoouqwcqwwagu, Constants::squoamkioomemiyi => $sqeykgyoooqysmca, Constants::ciywsqoeiymemsys => Constants::sgoswgskyiiwkyuo, Constants::yauicucwkgqyygas => $ycoeoaakqyskgykq, self::gikwakkmgcuukuqe => $eyykcmsqgsgcoosq], true); if ($sogksuscggsicmac && !is_wp_error($sogksuscggsicmac)) { $this->ewcsyqaaigkicgse('otp_request_generated', $sogksuscggsicmac[Constants::iikosyqiawkweouo], $eyykcmsqgsgcoosq, $mkucggyaiaukqoce); $this->ewcsyqaaigkicgse("otp_request_{$sqeykgyoooqysmca}_generated", $sogksuscggsicmac[Constants::iikosyqiawkweouo], $eyykcmsqgsgcoosq, $mkucggyaiaukqoce); } return $sogksuscggsicmac; } $goquwowugkygquya = $this->weysguygiseoukqw(Setting::uikmykkoogkquuga, 10) * MINUTE_IN_SECONDS; switch ($this->weysguygiseoukqw(Setting::ogugoagewigeqaus, Setting::vomgueyeygokyymg)) { case Setting::gciamaagkguugyku: $ikqugsuowecomsyg = $goquwowugkygquya * 2 ** ($kcayakscccogcmqe - $igugusokykuywkko - 1); break; default: $ikqugsuowecomsyg = $goquwowugkygquya; } $qkqgcaykemoiecma->gawcqwcqgwgucgya($cwagagqyawwowooo, $yeacayasgueouoqc + $ikqugsuowecomsyg, $ikqugsuowecomsyg); return $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(sprintf(__('Please try again after %s.', PR__UTL__OTP), $this->caokeucsksukesyo()->sgqicqeoumwmsmyw()->aaqkcwqaikooouus(ceil($ikqugsuowecomsyg / 60))), 429); } return false; } public function memcmkkekcuwgmio($wwuiyukigwskqyyi, $iueymcwwscwqkiyq = null) { $mogwwoaswuuykekc = $this->waecsyqmwascmqoa($wwuiyukigwskqyyi, self::uekycsgykyskuiea, 0); $icwicymcioeyeyek = [self::uekycsgykyskuiea => ++$mogwwoaswuuykekc]; if ($iueymcwwscwqkiyq) { $icwicymcioeyeyek[Constants::ciywsqoeiymemsys] = $iueymcwwscwqkiyq; } $this->gssiscqyqsacmeca()->wqikesawekycweoi($wwuiyukigwskqyyi, $icwicymcioeyeyek); } public function seeeuukuamcwiymk($eswwueuissckicww, $geooycqwwumugosu) { $wwuiyukigwskqyyi = $this->woimamkkeyoyauoa($eswwueuissckicww); if ($wwuiyukigwskqyyi) { if (!$this->aioikooomscaowqy($wwuiyukigwskqyyi)) { $ymacoouqwcqwwagu = $this->waecsyqmwascmqoa($wwuiyukigwskqyyi, self::eakceewagesqqyqm); if ($ymacoouqwcqwwagu === $geooycqwwumugosu) { $this->memcmkkekcuwgmio($wwuiyukigwskqyyi, Constants::gikauwqcswqcsmqw); $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $this->gssiscqyqsacmeca()->oisyoywgmmaawqmy([Constants::ciywsqoeiymemsys => Constants::qaquimukkogikqou], [$eqwoegegiamegqsm->megqywqeuquawkim(Constants::ciywsqoeiymemsys, Constants::sgoswgskyiiwkyuo), $eqwoegegiamegqsm->megqywqeuquawkim()->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim(Constants::yauicucwkgqyygas, $this->waecsyqmwascmqoa($wwuiyukigwskqyyi, Constants::yauicucwkgqyygas)))->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim(Constants::ioksewgkgwwikiwo, $this->waecsyqmwascmqoa($wwuiyukigwskqyyi, Constants::ioksewgkgwwikiwo)))->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim(self::gikwakkmgcuukuqe, $this->waecsyqmwascmqoa($wwuiyukigwskqyyi, self::gikwakkmgcuukuqe)))]); return $wwuiyukigwskqyyi; } $mogwwoaswuuykekc = $this->waecsyqmwascmqoa($wwuiyukigwskqyyi, self::uekycsgykyskuiea, 0); if ($mogwwoaswuuykekc + 1 > $this->kykguewkqcoosiqc()) { $this->memcmkkekcuwgmio($wwuiyukigwskqyyi, Constants::uasuowkaguiwoouw); return $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('You\'ve entered the wrong OTP too many times. Please request a new code.', PR__UTL__OTP), 429); } $this->memcmkkekcuwgmio($wwuiyukigwskqyyi); } else { $this->memcmkkekcuwgmio($wwuiyukigwskqyyi, Constants::qaquimukkogikqou); return $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('OTP expired', PR__UTL__OTP)); } return $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Incorrect OTP. Please try again.', PR__UTL__OTP)); } return $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('OTP not found.', PR__UTL__OTP), 404); } public function aioikooomscaowqy($wwuiyukigwskqyyi) : bool { $kwkmegesqkqwyska = $this->waecsyqmwascmqoa($wwuiyukigwskqyyi, Constants::CREATED_AT); $owiuekcekysskaoe = ($this->cwowqcisacowuqec() + 2) * MINUTE_IN_SECONDS; return $this->caokeucsksukesyo()->sgqicqeoumwmsmyw()->wguceomqgwouoyks(strtotime($kwkmegesqkqwyska) + $owiuekcekysskaoe); } public function woimamkkeyoyauoa($eqgoocgaqwqcimie) { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $gqgemcmoicmgaqie = $eqwoegegiamegqsm->kyckwuuiqwmyoqma(); $gqgemcmoicmgaqie->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::ciywsqoeiymemsys, Constants::sgoswgskyiiwkyuo))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->owogyemaccuymycq($this->kumuygiiqswoyasy())->yogqsokgsqemsuoq()); if (is_numeric($eqgoocgaqwqcimie)) { $gqgemcmoicmgaqie->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::yauicucwkgqyygas, $eqgoocgaqwqcimie)); } else { $sqeykgyoooqysmca = null; if ($this->uwkmaywceaaaigwo()->gyecsegqciqykomu()->qkgmsqgmwoamekyk($eqgoocgaqwqcimie)) { $sqeykgyoooqysmca = Constants::muqaqimusmckkieq; } else { if ($this->caokeucsksukesyo()->gyecsegqciqykomu()->qawecuimqqcqwgsw($eqgoocgaqwqcimie)) { $sqeykgyoooqysmca = Constants::skogicecygyyskkq; } } if ($sqeykgyoooqysmca) { $gqgemcmoicmgaqie->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::squoamkioomemiyi, $sqeykgyoooqysmca))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(self::gikwakkmgcuukuqe, $eqgoocgaqwqcimie)); } else { return null; } } return $this->iekyeyicoyyawomk()->oqomcmyuuakigusk($gqgemcmoicmgaqie); } public function kykguewkqcoosiqc() : int { return $this->weysguygiseoukqw(Setting::naysucikewmquweg, 5); } public function cwowqcisacowuqec() : int { return $this->weysguygiseoukqw(Setting::wucgeacouuakayuo, 5); } public function iswwcsskwikikwuk() : int { return $this->weysguygiseoukqw(Setting::sskwwcogekqoaaks, 5); } }
